
<nav class="navbar">
  <div class="container">
    <!-- Logo -->
    <a href="/" class="logo">
      <img src="/images/JKT logo bg.png" alt="Logo" class="nav-logo">
    </a>

    <div class="nav-search">
      <input
        type="text"
        id="globalSearch"
        placeholder="Search products or projects..."
        autocomplete="off"
      />
      <div id="searchResults" class="search-results"></div>
    </div>


    <!-- Hamburger -->
    <button class="menu-toggle" id="menu-toggle">
      <i class="fa fa-bars"></i>
    </button>

    <!-- Links -->
    <div class="nav-links" id="nav-links">

      <% if (user && user.role === 'admin') { %>

        <a href="/admin/dashboard">Dashboard</a>

        <!-- Store Dropdown -->
        <div class="dropdown">
          <button class="dropbtn">
            Store <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="/admin/products">Products</a>
            <a href="/admin/categories">Categories</a>
            <a href="/admin/promotions">Promotions</a>
            <a href="/admin/orders">Orders</a>
          </div>
        </div>

        <!-- Projects Dropdown -->
        <div class="dropdown">
          <button class="dropbtn">
            Projects <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="/admin/projects">All Projects</a>
            <a href="/admin/projects/bookings">Project Bookings</a>
          </div>
        </div>

        <!-- Users -->
        <a href="/admin/users">Users</a>

        <!-- Account -->
        <div class="dropdown">
          <button class="dropbtn">
            Account <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="/admin/profile">Profile</a>
            <a href="/auth/logout" class="logout-btn">Logout</a>
          </div>
        </div>

      <% } else if (user) { %>

        <a href="/">Home</a>

        <!-- Shop -->
        <div class="dropdown">
          <button class="dropbtn">
            Shop <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="/products">Products</a>
            <a href="/cart">Cart (<%= cartQty %>)</a>
          </div>
        </div>

        <!-- Projects -->
        
        <div class="dropdown">
          <button class="dropbtn">
            Project <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="/projects">Projects List</a>
            <a href="/projects/dashboard/userProjects">My Bookings</a>
          </div>
        </div>


        <!-- Account -->
        <div class="dropdown nav-profile">
          <button class="dropbtn profile-btn">
            <% if (user.profile_image) { %>
              <img src="<%= user.profile_image %>" class="profile-icon">
            <% } else { %>
              <i class="fa fa-user-circle"></i>
            <% } %>
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content right">
            <a href="/orders">My Orders</a>
            <a href="/dashboard/projects">My Projects</a>
            <a href="/users/profile">Profile</a>
            <a href="/auth/logout" class="logout-btn">Logout</a>
          </div>
        </div>

      <% } else { %>

        <a href="/">Home</a>
        <a href="/products">Shop</a>
        <a href="/projects">Projects</a>
        <a href="/auth/login">Login</a>
        <a href="/auth/signup">Signup</a>

      <% } %>

    </div>
  </div>
</nav>




<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("menu-toggle");
    const navLinks = document.getElementById("nav-links");
    const dropdowns = document.querySelectorAll(".dropdown");

    toggleBtn.addEventListener("click", () => {
      navLinks.classList.toggle("active");
    });

    dropdowns.forEach(dropdown => {
      dropdown.querySelector(".dropbtn").addEventListener("click", (e) => {
        e.preventDefault();
        dropdown.classList.toggle("active");
      });
    });
  });
</script>

<!-- <script>
const searchInput = document.getElementById("globalSearch");
const resultsBox = document.getElementById("searchResults");

let timeout = null;

searchInput.addEventListener("input", () => {
  clearTimeout(timeout);

  const query = searchInput.value.trim();

  if (!query) {
    resultsBox.style.display = "none";
    return;
  }

  timeout = setTimeout(async () => {
    const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
    const data = await res.json();

    resultsBox.innerHTML = "";

    if (data.length === 0) {
      resultsBox.innerHTML = `<div class="search-item">No results</div>`;
    } else {
      data.forEach(item => {
        const div = document.createElement("div");
        div.className = "search-item";

        div.innerHTML = `
          <strong>${item.title}</strong>
          <div class="search-type">${item.type}</div>
        `;

        div.onclick = () => {
          if (item.type === "product") {
            window.location.href = `/products/${item.id}`;
          } else {
            window.location.href = `/projects/${item.id}`;
          }
        };

        resultsBox.appendChild(div);
      });
    }

    resultsBox.style.display = "block";
  }, 300);
});

document.addEventListener("click", (e) => {
  if (!e.target.closest(".nav-search")) {
    resultsBox.style.display = "none";
  }
});
</script> -->


<script>
const searchInput = document.getElementById("globalSearch");
const resultsBox = document.getElementById("searchResults");

let timeout = null;

searchInput.addEventListener("input", () => {
  clearTimeout(timeout);
  const query = searchInput.value.trim();

  if (!query) {
    resultsBox.style.display = "none";
    return;
  }

  timeout = setTimeout(async () => {
    const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
    const data = await res.json();

    resultsBox.innerHTML = "";

    if (data.length === 0) {
      resultsBox.innerHTML = `<div class="search-item empty">No results found</div>`;
    } else {
      data.forEach(item => {
        const priceText =
          item.type === "product"
            ? `₦${Number(item.price).toLocaleString()}`
            : item.price
              ? `₦${Number(item.price).toLocaleString()} (${item.price_type})`
              : "Request Quote";

        const div = document.createElement("div");
        div.className = "search-item";

        div.innerHTML = `
          <img src="${item.image || '/images/placeholder.png'}" />
          <div class="search-info">
            <strong>${item.title}</strong>
            <span class="search-type">${item.type}</span>
            <span class="search-price">${priceText}</span>
          </div>
        `;

        div.onclick = () => {
          window.location.href =
            item.type === "product"
              ? `/products/${item.id}`
              : `/projects/${item.id}`;
        };

        resultsBox.appendChild(div);
      });
    }

    resultsBox.style.display = "block";
  }, 300);
});

document.addEventListener("click", (e) => {
  if (!e.target.closest(".nav-search")) {
    resultsBox.style.display = "none";
  }
});
</script>


