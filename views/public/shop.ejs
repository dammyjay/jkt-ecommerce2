
<section>
  <div class="container" style="margin-top: 60px;">
    <h1>Our Products</h1>

    <!-- Categories -->
    <div style="margin: 20px 0; display: flex; flex-wrap: wrap; gap: 10px;">
      <button
        class="btn btn-secondary filter-btn btn-filter-active"
        onclick="filterCategory('all', this)"
      >
        All
      </button>

      <% categories.forEach(cat => { %>
        <button
          class="btn btn-secondary filter-btn"
          onclick="filterCategory('<%= cat.id %>', this)"
        >
          <%= cat.name %>
        </button>
      <% }) %>
    </div>

    <!-- Products Grid -->
    <div
      style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
      "
    >
      <% products.forEach(product => { %>
        <div
          class="card product-card"
          data-category="<%= product.category_id %>"
        >
          <img
            src="<%= product.image_url %>"
            alt="<%= product.name %>"
            style="
              width: 100%;
              height: 180px;
              object-fit: cover;
              border-radius: 8px;
              margin-bottom: 10px;
            "
          />

          <h4><%= product.name %></h4>

          <p style="color: var(--color-muted); font-size: 0.9rem;">
            <%= product.category_name %>
          </p>

          <p style="font-weight: 600;">
            â‚¦<%= product.price.toLocaleString() %>
          </p>

          <a
            href="/products/<%= product.id %>"
            class="btn btn-primary btn-full"
            style="margin-top: 10px;"
          >
            View Details
          </a>
        </div>
      <% }) %>
    </div>
  </div>
</section>

<script>
  // Map of category IDs to names
  const categoriesMap = {
    all: 'All',
    <% categories.forEach(cat => { %>
      '<%= cat.id %>': '<%= cat.name %>',
    <% }) %>
  };

  // Filter products by category
  function filterCategory(categoryId, activeBtn) {
    const cards = document.querySelectorAll('.product-card');
    const buttons = document.querySelectorAll('.filter-btn');

    // Reset active button
    buttons.forEach(btn => btn.classList.remove('btn-filter-active'));
    if(activeBtn) activeBtn.classList.add('btn-filter-active');

    // Show/hide products
    cards.forEach(card => {
      if(categoryId === 'all' || card.dataset.category === categoryId) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }

  // Auto-filter based on URL query parameter
  const urlParams = new URLSearchParams(window.location.search);
  const categoryId = urlParams.get('category') || 'all';

  // Find matching button
  const activeBtn = Array.from(document.querySelectorAll('.filter-btn'))
    .find(btn => btn.textContent.trim() === categoriesMap[categoryId] || categoryId === 'all');

  // Apply initial filter
  filterCategory(categoryId, activeBtn);
</script>

